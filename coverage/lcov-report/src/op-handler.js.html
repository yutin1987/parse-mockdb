<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/op-handler.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">src/</a> op-handler.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">32.56% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>14/43</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">28.57% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>4/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">29.41% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>5/17</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">32.5% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>13/40</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// Ensures `object` has an array at `key`. Creates array if `key` doesn't exist.
// Will throw if value for `key` exists and is not Array.
'use strict';
&nbsp;
Object.defineProperty(exports, '__esModule', {
  value: true
});
function ensureArray(object, key) {
  <span class="missing-if-branch" title="if path not taken" >I</span>if (!object[key]) {
<span class="cstat-no" title="statement not covered" >    object[key] = new Array();</span>
  }
  <span class="missing-if-branch" title="if path not taken" >I</span>if (!Array.isArray(object[key])) {
<span class="cstat-no" title="statement not covered" >    throw new Error("Can't perform array operaton on non-array field");</span>
  }
}
&nbsp;
/**
 * Operator functions assume binding to **object** on which update operator is to be applied.
 *
 * Params:
 *    key   - value to be modified in bound object.
 *    value - operator value, i.e. `{__op: "Increment", amount: 1}`
 */
exports['default'] = {
  Increment: <span class="fstat-no" title="function not covered" >function Increment(obj, key, value) {</span>
<span class="cstat-no" title="statement not covered" >    obj[key] += value.amount;</span>
  },
  Add: function Add(obj, key, value) {
    ensureArray(obj, key);
    value.objects.forEach(function (object) {
      obj[key].push(object);
    });
  },
  AddUnique: function AddUnique(obj, key, value) {
    ensureArray(obj, key);
    var array = obj[key];
    value.objects.forEach(function (object) {
      if (array.indexOf(object) === -1) array.push(object);
    });
  },
  Remove: <span class="fstat-no" title="function not covered" >function Remove(obj, key, value) {</span>
<span class="cstat-no" title="statement not covered" >    ensureArray(obj, key);</span>
<span class="cstat-no" title="statement not covered" >    var array = obj[key];</span>
<span class="cstat-no" title="statement not covered" >    value.objects.forEach(<span class="fstat-no" title="function not covered" >function (object) {</span></span>
<span class="cstat-no" title="statement not covered" >      obj[key] = _.reject(array, <span class="fstat-no" title="function not covered" >function (item) {</span></span>
<span class="cstat-no" title="statement not covered" >        return item === object;</span>
      });
    });
  },
  Delete: <span class="fstat-no" title="function not covered" >function Delete(obj, key, value) {</span>
<span class="cstat-no" title="statement not covered" >    delete obj[key];</span>
  },
  Batch: <span class="fstat-no" title="function not covered" >function Batch(obj, key, value) {</span>
<span class="cstat-no" title="statement not covered" >    var addRelation = value.ops.filter(<span class="fstat-no" title="function not covered" >function (op) {</span></span>
<span class="cstat-no" title="statement not covered" >      return op.__op === 'AddRelation';</span>
    })[0];
<span class="cstat-no" title="statement not covered" >    this.AddRelation.bind(obj)(key, addRelation);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var removeRelation = value.ops.filter(<span class="fstat-no" title="function not covered" >function (op) {</span></span>
<span class="cstat-no" title="statement not covered" >      return op.__op === 'RemoveRelation';</span>
    })[0];
<span class="cstat-no" title="statement not covered" >    this.RemoveRelation.bind(obj)(key, removeRelation);</span>
  },
  AddRelation: <span class="fstat-no" title="function not covered" >function AddRelation(obj, key, value) {</span>
<span class="cstat-no" title="statement not covered" >    if (!obj[key]) {</span>
<span class="cstat-no" title="statement not covered" >      obj[key] = { __type: 'Relation', className: value.objects[0].className, ids: [] };</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    console.log(obj[key]);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    value.objects.forEach(<span class="fstat-no" title="function not covered" >function (pointer) {</span></span>
<span class="cstat-no" title="statement not covered" >      var idx = obj[key].ids.indexOf(pointer.objectId);</span>
<span class="cstat-no" title="statement not covered" >      if (idx &lt; 0) <span class="cstat-no" title="statement not covered" >obj[key].ids.push(pointer.objectId);</span></span>
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    obj[key].ids = obj[key].ids.sort();</span>
  },
  RemoveRelation: <span class="fstat-no" title="function not covered" >function RemoveRelation(obj, key, value) {</span>
<span class="cstat-no" title="statement not covered" >    if (!obj[key]) {</span>
<span class="cstat-no" title="statement not covered" >      obj[key] = { __type: 'Relation', className: value.objects[0].className, ids: [] };</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    value.objects.forEach(<span class="fstat-no" title="function not covered" >function (pointer) {</span></span>
<span class="cstat-no" title="statement not covered" >      var idx = obj[key].ids.indexOf(pointer.objectId);</span>
<span class="cstat-no" title="statement not covered" >      if (idx &gt; -1) <span class="cstat-no" title="statement not covered" >obj[key].ids.splice(idx, 1);</span></span>
    });
  }
};
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy95dXRpbi9EZXZlbG9wL2dpdGh1Yi9wYXJzZS1tb2NrZGIvc3JjL29wLWhhbmRsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVBLFNBQVMsV0FBVyxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUU7QUFDaEMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRTtBQUNoQixVQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztHQUMzQjtBQUNELE1BQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO0FBQy9CLFVBQU0sSUFBSSxLQUFLLENBQUMsaURBQWlELENBQUMsQ0FBQztHQUNwRTtDQUNGOzs7Ozs7Ozs7cUJBU2M7QUFDYixXQUFTLEVBQUUsbUJBQVMsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUU7QUFDbkMsT0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUM7R0FDMUI7QUFDRCxLQUFHLEVBQUUsYUFBUyxHQUFHLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRTtBQUM3QixlQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQ3RCLFNBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUEsTUFBTSxFQUFJO0FBQzlCLFNBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDdkIsQ0FBQyxDQUFBO0dBQ0g7QUFDRCxXQUFTLEVBQUUsbUJBQVMsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUU7QUFDbkMsZUFBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN0QixRQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDdkIsU0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBQSxNQUFNLEVB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LEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsQ0FBQztLQUNuRjs7QUFFRCxTQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFBLE9BQU8sRUFBSTtBQUMvQixVQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDbkQsVUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzNDLENBQUMsQ0FBQztHQUNKO0NBQ0YiLCJmaWxlIjoiL1VzZXJzL3l1dGluL0RldmVsb3AvZ2l0aHViL3BhcnNlLW1vY2tkYi9zcmMvb3AtaGFuZGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEVuc3VyZXMgYG9iamVjdGAgaGFzIGFuIGFycmF5IGF0IGBrZXlgLiBDcmVhdGVzIGFycmF5IGlmIGBrZXlgIGRvZXNuJ3QgZXhpc3QuXG4vLyBXaWxsIHRocm93IGlmIHZhbHVlIGZvciBga2V5YCBleGlzdHMgYW5kIGlzIG5vdCBBcnJheS5cbmZ1bmN0aW9uIGVuc3VyZUFycmF5KG9iamVjdCwga2V5KSB7XG4gIGlmICghb2JqZWN0W2tleV0pIHtcbiAgICBvYmplY3Rba2V5XSA9IG5ldyBBcnJheSgpO1xuICB9XG4gIGlmICghQXJyYXkuaXNBcnJheShvYmplY3Rba2V5XSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBwZXJmb3JtIGFycmF5IG9wZXJhdG9uIG9uIG5vbi1hcnJheSBmaWVsZFwiKTtcbiAgfVxufVxuXG4vKipcbiAqIE9wZXJhdG9yIGZ1bmN0aW9ucyBhc3N1bWUgYmluZGluZyB0byAqKm9iamVjdCoqIG9uIHdoaWNoIHVwZGF0ZSBvcGVyYXRvciBpcyB0byBiZSBhcHBsaWVkLlxuICpcbiAqIFBhcmFtczpcbiAqICAgIGtleSAgIC0gdmFsdWUgdG8gYmUgbW9kaWZpZWQgaW4gYm91bmQgb2JqZWN0LlxuICogICAgdmFsdWUgLSBvcGVyYXRvciB2YWx1ZSwgaS5lLiBge19fb3A6IFwiSW5jcmVtZW50XCIsIGFtb3VudDogMX1gXG4gKi9cbmV4cG9ydCBkZWZhdWx0IHtcbiAgSW5jcmVtZW50OiBmdW5jdGlvbihvYmosIGtleSwgdmFsdWUpIHtcbiAgICBvYmpba2V5XSArPSB2YWx1ZS5hbW91bnQ7XG4gIH0sXG4gIEFkZDogZnVuY3Rpb24ob2JqLCBrZXksIHZhbHVlKSB7XG4gICAgZW5zdXJlQXJyYXkob2JqLCBrZXkpO1xuICAgIHZhbHVlLm9iamVjdHMuZm9yRWFjaChvYmplY3QgPT4ge1xuICAgICAgb2JqW2tleV0ucHVzaChvYmplY3QpO1xuICAgIH0pXG4gIH0sXG4gIEFkZFVuaXF1ZTogZnVuY3Rpb24ob2JqLCBrZXksIHZhbHVlKSB7XG4gICAgZW5zdXJlQXJyYXkob2JqLCBrZXkpO1xuICAgIGNvbnN0IGFycmF5ID0gb2JqW2tleV07XG4gICAgdmFsdWUub2JqZWN0cy5mb3JFYWNoKG9iamVjdCA9PiB7XG4gICAgICBpZiAoYXJyYXkuaW5kZXhPZihvYmplY3QpID09PSAtMSkgYXJyYXkucHVzaChvYmplY3QpO1xuICAgIH0pO1xuICB9LFxuICBSZW1vdmU6IGZ1bmN0aW9uKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGVuc3VyZUFycmF5KG9iaiwga2V5KTtcbiAgICB2YXIgYXJyYXkgPSBvYmpba2V5XTtcbiAgICB2YWx1ZS5vYmplY3RzLmZvckVhY2gob2JqZWN0ID0+IHtcbiAgICAgIG9ialtrZXldID0gXy5yZWplY3QoYXJyYXksIGl0ZW0gPT4geyByZXR1cm4gaXRlbSA9PT0gb2JqZWN0IH0pO1xuICAgIH0pO1xuICB9LFxuICBEZWxldGU6IGZ1bmN0aW9uKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGRlbGV0ZSBvYmpba2V5XTtcbiAgfSxcbiAgQmF0Y2g6IGZ1bmN0aW9uKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGNvbnN0IGFkZFJlbGF0aW9uID0gdmFsdWUub3BzLmZpbHRlcihvcCA9PiBvcC5fX29wID09PSAnQWRkUmVsYXRpb24nKVswXTtcbiAgICB0aGlzLkFkZFJlbGF0aW9uLmJpbmQob2JqKShrZXksIGFkZFJlbGF0aW9uKVxuXG4gICAgY29uc3QgcmVtb3ZlUmVsYXRpb24gPSB2YWx1ZS5vcHMuZmlsdGVyKG9wID0+IG9wLl9fb3AgPT09ICdSZW1vdmVSZWxhdGlvbicpWzBdO1xuICAgIHRoaXMuUmVtb3ZlUmVsYXRpb24uYmluZChvYmopKGtleSwgcmVtb3ZlUmVsYXRpb24pXG4gIH0sXG4gIEFkZFJlbGF0aW9uOiBmdW5jdGlvbihvYmosIGtleSwgdmFsdWUpIHtcbiAgICBpZiAoIW9ialtrZXldKSB7XG4gICAgICBvYmpba2V5XSA9IHsgX190eXBlOiAnUmVsYXRpb24nLCBjbGFzc05hbWU6IHZhbHVlLm9iamVjdHNbMF0uY2xhc3NOYW1lLCBpZHM6IFtdIH07XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2cob2JqW2tleV0pO1xuICAgIFxuICAgIHZhbHVlLm9iamVjdHMuZm9yRWFjaChwb2ludGVyID0+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG9ialtrZXldLmlkcy5pbmRleE9mKHBvaW50ZXIub2JqZWN0SWQpO1xuICAgICAgaWYgKGlkeCA8IDApIG9ialtrZXldLmlkcy5wdXNoKHBvaW50ZXIub2JqZWN0SWQpO1xuICAgIH0pO1xuXG4gICAgb2JqW2tleV0uaWRzID0gb2JqW2tleV0uaWRzLnNvcnQoKTtcbiAgfSxcbiAgUmVtb3ZlUmVsYXRpb246IGZ1bmN0aW9uKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGlmICghb2JqW2tleV0pIHtcbiAgICAgIG9ialtrZXldID0geyBfX3R5cGU6ICdSZWxhdGlvbicsIGNsYXNzTmFtZTogdmFsdWUub2JqZWN0c1swXS5jbGFzc05hbWUsIGlkczogW10gfTtcbiAgICB9XG5cbiAgICB2YWx1ZS5vYmplY3RzLmZvckVhY2gocG9pbnRlciA9PiB7XG4gICAgICBjb25zdCBpZHggPSBvYmpba2V5XS5pZHMuaW5kZXhPZihwb2ludGVyLm9iamVjdElkKTtcbiAgICAgIGlmIChpZHggPiAtMSkgb2JqW2tleV0uaWRzLnNwbGljZShpZHgsIDEpO1xuICAgIH0pO1xuICB9XG59OyJdfQ==</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Dec 20 2015 18:43:45 GMT+0800 (CST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
